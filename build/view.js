(()=>{class t{constructor(t){if(this.wrapper=t,this.nav=t.querySelector(".wp-block-navigation"),!this.nav)return;this.list=this.nav.querySelector(".wp-block-navigation__container"),this.moreLabel=t.getAttribute("data-more-label")||"More",this.moreIcon=t.getAttribute("data-more-icon")||"dots";let e=null;if(this.nav.attributes)for(let t=0;t<this.nav.attributes.length;t++){const i=this.nav.attributes[t],s=i.name.toLowerCase();if(s.includes("open")&&s.includes("submenu")&&s.includes("click")){e=i.value;break}if("data-opensubmenusonclick"===s||"data-open-submenus-on-click"===s){e=i.value;break}}if(null===e&&(this.nav.classList.contains("open-on-click")||this.nav.classList.contains("open-submenus-on-click")||this.nav.classList.contains("has-open-submenus-on-click"))&&(e="true"),null===e&&this.list){const t=this.list.querySelector("li.has-child, li.open-on-click");t&&(t.classList.contains("open-on-click")||t.classList.contains("open-submenus-on-click"))&&(e="true")}this.openSubmenusOnClick="true"===e||"1"===e||""===e,this.list&&(this.createMoreButton(),this.items=Array.from(this.list.children),this.itemWidths=[],this.isOpen=!1,this.isCalculating=!1,this.openAccordions=[],this.submenuCounter=0,this.responsiveContainer=this.nav.querySelector(".wp-block-navigation__responsive-container"),this.mutationObserver=null,this.retryTimeout=null,this.isEnabled=!0,this.init())}createMoreButton(){this.moreContainer=document.createElement("div"),this.moreContainer.className="priority-nav-more",this.moreButton=document.createElement("button"),this.moreButton.type="button",this.moreButton.className="priority-nav-more-button wp-block-navigation-item",this.moreButton.setAttribute("aria-expanded","false"),this.moreButton.setAttribute("aria-haspopup","true"),this.moreButton.setAttribute("aria-label",this.moreLabel);const t={dots:"•••",chevron:"▼",plus:"+",menu:"≡"};this.moreButton.innerHTML=`\n\t\t\t<span class="wp-block-navigation-item__label">${this.moreLabel}</span>\n\t\t\t<span class="priority-nav-icon">${t[this.moreIcon]||t.dots}</span>\n\t\t`,this.dropdown=document.createElement("ul"),this.dropdown.className="priority-nav-dropdown wp-block-navigation__submenu-container",this.dropdown.setAttribute("role","menu"),this.moreContainer.appendChild(this.moreButton),this.moreContainer.appendChild(this.dropdown),this.list.parentNode.appendChild(this.moreContainer),this.moreContainer.style.display="none"}init(){this.setupEventListeners(),this.setupResponsiveObserver(),this.isInHamburgerMode()?this.disablePriorityNav():this.enablePriorityNav(),new ResizeObserver(()=>{if(!this.isCalculating){const t=this.isEnabled,e=this.isInHamburgerMode();e&&t?this.disablePriorityNav():e||t?!e&&t&&requestAnimationFrame(()=>this.checkOverflow()):this.enablePriorityNav()}}).observe(this.wrapper)}isInHamburgerMode(){if(this.responsiveContainer){const t=window.getComputedStyle(this.responsiveContainer);if("none"===t.display||"hidden"===t.visibility||"true"===this.responsiveContainer.getAttribute("aria-hidden"))return!0}if(this.list){const t=window.getComputedStyle(this.list),e=this.list.getBoundingClientRect();if("none"===t.display||"hidden"===t.visibility||0===e.width)return!0}return!1}isMeasurable(){if(!this.list)return!1;const t=window.getComputedStyle(this.list),e=this.list.getBoundingClientRect();return"none"!==t.display&&"hidden"!==t.visibility&&e.width>0&&e.height>0}disablePriorityNav(){this.isEnabled=!1,this.items.forEach(t=>{t.style.display=""}),this.moreContainer&&(this.moreContainer.style.display="none"),this.closeDropdown()}enablePriorityNav(){this.isEnabled=!0,this.isMeasurable()?((0===this.itemWidths.length||this.itemWidths.some(t=>0===t))&&this.cacheItemWidths(),requestAnimationFrame(()=>{this.checkOverflow()})):this.scheduleRetry()}scheduleRetry(t=20){this.retryTimeout&&clearTimeout(this.retryTimeout);let e=0;const i=()=>{e++,this.isMeasurable()&&!this.isInHamburgerMode()?(this.enablePriorityNav(),this.retryTimeout=null):this.retryTimeout=e<t?setTimeout(i,100):null};this.retryTimeout=setTimeout(i,100)}setupResponsiveObserver(){this.responsiveContainer&&(this.mutationObserver=new MutationObserver(t=>{let e=!1;if(t.forEach(t=>{"attributes"!==t.type||"aria-hidden"!==t.attributeName&&"class"!==t.attributeName||(e=!0)}),e){const t=this.isInHamburgerMode();t&&this.isEnabled?this.disablePriorityNav():t||this.isEnabled||this.enablePriorityNav()}}),this.mutationObserver.observe(this.responsiveContainer,{attributes:!0,attributeFilter:["aria-hidden","class"]}),this.list&&this.mutationObserver.observe(this.list,{attributes:!0,attributeFilter:["style","class"],attributeOldValue:!1}))}cacheItemWidths(){this.isMeasurable()&&(this.items.forEach(t=>{t.style.display=""}),this.list.offsetHeight,this.itemWidths=this.items.map(t=>{const e=t.getBoundingClientRect();return e.width>0?e.width:0}),this.itemWidths.some(t=>0===t)&&this.scheduleRetry())}setupEventListeners(){this.moreButton.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.toggleDropdown()}),document.addEventListener("click",t=>{!this.moreContainer.contains(t.target)&&this.isOpen&&this.closeDropdown()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.isOpen&&(this.openAccordions.length>0?(this.closeAllAccordions(),t.preventDefault()):this.closeDropdown())}),this.dropdown.addEventListener("click",t=>{const e=t.target.closest(".priority-nav-accordion-toggle");if(e){t.preventDefault(),t.stopPropagation();const i=e.getAttribute("aria-controls"),s=document.getElementById(i);s&&this.toggleAccordionItem(e,s)}})}checkOverflow(){if(!this.isEnabled||!this.isMeasurable())return void(this.isCalculating=!1);this.isCalculating=!0;const t=this.nav.getBoundingClientRect(),e=window.getComputedStyle(this.nav),i=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight),s=window.getComputedStyle(this.list),n=parseFloat(s.gap)||parseFloat(e.gap)||8;let o=t.width>0?t.width-i:this.wrapper.getBoundingClientRect().width-i;this.moreContainer.style.display="",this.moreButton.offsetHeight;const r=this.moreButton.getBoundingClientRect().width;if((0===this.itemWidths.length||this.itemWidths.some(t=>0===t))&&(this.cacheItemWidths(),0===this.itemWidths.length||this.itemWidths.some(t=>0===t)))return void(this.isCalculating=!1);let a=0,l=0;for(let t=0;t<this.items.length;t++)l+=(t>0?n:0)+this.itemWidths[t];if(l<=o)return this.items.forEach(t=>t.style.display=""),this.moreContainer.style.display="none",this.closeDropdown(),void(this.isCalculating=!1);let c=0;for(let t=0;t<this.items.length;t++){const e=(t>0?n:0)+this.itemWidths[t];if(!(c+e+n+r<=o)&&0!==t)break;this.items[t].style.display="",c+=e,a++}this.dropdown.innerHTML="",this.submenuCounter=0;let h=!1;for(let t=a;t<this.items.length;t++){this.items[t].style.display="none";const e=this.extractNavItemData(this.items[t]),i=this.buildAccordionHTML(e,0),s=document.createElement("li");s.innerHTML=i,this.dropdown.appendChild(s),h=!0}h?this.moreContainer.style.display="":(this.moreContainer.style.display="none",this.closeDropdown()),this.isCalculating=!1}toggleDropdown(){this.isOpen?this.closeDropdown():this.openDropdown()}openDropdown(){this.isOpen=!0,this.dropdown.classList.add("is-open"),this.moreButton.setAttribute("aria-expanded","true")}closeDropdown(){this.isOpen=!1,this.dropdown.classList.remove("is-open"),this.moreButton.setAttribute("aria-expanded","false"),this.closeAllAccordions()}extractNavItemData(t){const e={text:"",url:"#",hasSubmenu:!1,children:[]},i=t.querySelector(":scope > .wp-block-navigation__submenu-container");let s=t.querySelector(":scope > a");if(s||(s=t.querySelector(":scope > .wp-block-navigation-item__content a")),!s){if(i){const i=t.cloneNode(!0),s=i.querySelector(".wp-block-navigation__submenu-container");s&&s.remove(),e.text=i.textContent.trim()}else e.text=t.textContent.trim();return i&&(e.hasSubmenu=!0,i.querySelectorAll(":scope > li").forEach(t=>{e.children.push(this.extractNavItemData(t))})),e}const n=s.querySelector(".wp-block-navigation-item__label");if(n)e.text=n.textContent.trim();else{const t=s.cloneNode(!0);if(t.querySelectorAll("*").forEach(t=>t.remove()),e.text=t.textContent.trim(),!e.text){const t=Array.from(s.childNodes).filter(t=>t.nodeType===Node.TEXT_NODE);t.length>0&&(e.text=t.map(t=>t.textContent.trim()).filter(t=>t).join(" "))}}if(i&&e.text){const t=[];i.querySelectorAll("li a").forEach(i=>{const s=i.textContent.trim();s&&e.text.includes(s)&&t.push(s)}),t.length>0&&t.forEach(t=>{e.text=e.text.replace(t,"").trim()})}return e.url=s.getAttribute("href")||"#",i&&(e.hasSubmenu=!0,i.querySelectorAll(":scope > li").forEach(t=>{e.children.push(this.extractNavItemData(t))})),e}buildAccordionHTML(t,e){const i="priority-nav-submenu-"+this.submenuCounter++;let s="";return t.hasSubmenu?(s=this.openSubmenusOnClick?`\n\t\t\t\t\t<button type="button" class="priority-nav-accordion-toggle priority-nav-accordion-toggle-full" \n\t\t\t\t\t        aria-expanded="false" aria-controls="${i}">\n\t\t\t\t\t\t<span class="priority-nav-accordion-text">${this.escapeHtml(t.text)}</span>\n\t\t\t\t\t\t<span class="priority-nav-accordion-arrow" aria-hidden="true">›</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<ul class="priority-nav-accordion-content" id="${i}" aria-hidden="true">\n\t\t\t\t`:`\n\t\t\t\t\t<span class="priority-nav-accordion-wrapper">\n\t\t\t\t\t\t<a href="${this.escapeHtml(t.url)}" class="priority-nav-accordion-link">${this.escapeHtml(t.text)}</a>\n\t\t\t\t\t\t<button type="button" class="priority-nav-accordion-toggle priority-nav-accordion-toggle-arrow" \n\t\t\t\t\t\t        aria-expanded="false" aria-controls="${i}" aria-label="Toggle submenu">\n\t\t\t\t\t\t\t<span class="priority-nav-accordion-arrow" aria-hidden="true">›</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</span>\n\t\t\t\t\t<ul class="priority-nav-accordion-content" id="${i}" aria-hidden="true">\n\t\t\t\t`,t.children.forEach(t=>{s+=`<li>${this.buildAccordionHTML(t,e+1)}</li>`}),s+="</ul>"):s=`<a href="${this.escapeHtml(t.url)}">${this.escapeHtml(t.text)}</a>`,s}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}toggleAccordionItem(t,e){"true"===t.getAttribute("aria-expanded")?(t.setAttribute("aria-expanded","false"),e.style.setProperty("display","none","important"),e.classList.remove("is-open"),e.setAttribute("aria-hidden","true"),this.openAccordions=this.openAccordions.filter(e=>e.button!==t),e.querySelectorAll('.priority-nav-accordion-toggle[aria-expanded="true"]').forEach(t=>{const e=t.getAttribute("aria-controls"),i=document.getElementById(e);i&&(t.setAttribute("aria-expanded","false"),i.style.setProperty("display","none","important"),i.classList.remove("is-open"),i.setAttribute("aria-hidden","true"))})):(t.setAttribute("aria-expanded","true"),e.style.setProperty("display","block","important"),e.style.setProperty("opacity","1","important"),e.style.setProperty("visibility","visible","important"),e.style.setProperty("position","static","important"),e.classList.add("is-open"),e.setAttribute("aria-hidden","false"),this.openAccordions.push({button:t,submenu:e}))}closeAllAccordions(){this.openAccordions.forEach(({button:t,submenu:e})=>{t.setAttribute("aria-expanded","false"),e.style.setProperty("display","none","important"),e.classList.remove("is-open"),e.setAttribute("aria-hidden","true")}),this.openAccordions=[]}destroy(){this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=null)}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-priority-nav]").forEach(e=>new t(e))})})();